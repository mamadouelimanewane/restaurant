<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerangaReserve | La Cr√®me des Restaurants au S√©n√©gal</title>

    <!-- PWA Meta Tags -->
    <meta name="description"
        content="D√©couvrez et r√©servez les meilleurs restaurants du S√©n√©gal. Programme de fid√©lit√©, avis v√©rifi√©s, g√©olocalisation.">
    <meta name="theme-color" content="#003580">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TerangaReserve">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">

    <!-- Preconnect pour les ressources externes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://images.unsplash.com">
    <link rel="dns-prefetch" href="https://unpkg.com">

    <!-- Preload des ressources critiques -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="gallery.css">
    <link rel="stylesheet" href="chat.css">
    <link rel="stylesheet" href="features.css">
    <link rel="stylesheet" href="advanced-features.css">
    <link rel="stylesheet" href="responsive.css">
    <link rel="preload" href="/app.js" as="script">
    <link rel="preload" href="/data.js" as="script">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:wght@700;900&display=swap"
        rel="stylesheet">

    <!-- CSS is handled by Vite via app.js imports, keeping these for quick dev loading if needed but app.js imports them -->
</head>

<body>
    <header class="hero">
        <div class="container nav-bar">
            <div class="logo">TerangaReserve.sn</div>
            <a href="carte.html" class="mobile-map-link mobile-only"
                style="color: white; font-weight: 600; text-decoration: none; margin-left: auto; margin-right: 10px; border: 1px solid rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; display: none;">üó∫Ô∏è
                Cartographie</a>
            <button class="mobile-menu-toggle" aria-label="Menu" onclick="toggleMobileMenu()">‚ò∞</button>
            <div class="nav-links" id="navLinks">
                <a href="carte.html" style="text-decoration: none;"><button>üó∫Ô∏è Cartographie</button></a>
                <button onclick="openUserDashboard()">üìä Mon Dashboard</button>
                <button onclick="openPassport()">üõÇ Mon Passeport</button>
                <button onclick="toggleOwnerDashboard()">Espace Restaurateur</button>
                <button onclick="toggleMapView()">Carte</button>
            </div>
        </div>
        <div class="container hero-content">
            <h1>Trouvez votre prochain restaurant</h1>
            <p>De Dakar √† Saint-Louis, r√©servez la table id√©ale au meilleur prix.</p>
        </div>
    </header>

    <div class="container">
        <div class="search-bar">
            <div class="search-box destination-wrapper">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchInput" placeholder="O√π allez-vous ?" onfocus="showDestinations(event)"
                    onclick="showDestinations(event)" onkeyup="filterDestinations()">
                <div id="destinationDropdown" class="destination-dropdown">
                    <div class="dropdown-item" onclick="selectDestination('Dakar')">üìç <strong>Dakar</strong>, S√©n√©gal
                    </div>
                    <div class="dropdown-item" onclick="selectDestination('Saly')">üìç <strong>Saly</strong>, Mbour</div>
                    <div class="dropdown-item" onclick="selectDestination('Saint-Louis')">üìç
                        <strong>Saint-Louis</strong>, S√©n√©gal
                    </div>
                    <div class="dropdown-item" onclick="selectDestination('Cap Skirring')">üìç <strong>Cap
                            Skirring</strong>, Casamance</div>
                </div>
            </div>
            <div class="search-box">
                <span class="search-icon">üìÖ</span>
                <input type="date" id="searchDate">
            </div>
            <div class="search-box">
                <span class="search-icon">‚è∞</span>
                <select id="searchTime">
                    <option>19:00</option>
                    <option>20:00</option>
                    <option>21:00</option>
                </select>
            </div>
            <div class="search-box">
                <span class="search-icon">üë§</span>
                <input type="number" id="searchPax" value="2" min="1">
            </div>
            <button class="search-trigger" onclick="filterRestaurants()">Rechercher</button>
        </div>
    </div>

    <main class="container main-layout">
        <aside class="filters-sidebar">
            <div class="concierge-card"
                style="margin-bottom: 2rem; background: #fff; padding: 1.25rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid #e0e0e0;">
                <div class="concierge-header"
                    style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <span class="magic-icon" style="font-size: 1.5rem;">‚ú®</span>
                    <div class="concierge-info">
                        <h3 style="margin: 0; color: #003580; font-size: 1.1rem;">Concierge IA</h3>
                        <p style="margin: 0; font-size: 0.85rem; color: #666;">Une envie particuli√®re ?</p>
                    </div>
                </div>
                <div class="concierge-input-wrapper">
                    <input type="text" id="conciergeInput" placeholder="Ex: Romantique, vue mer..."
                        style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem;"
                        onkeyup="if(event.key==='Enter') runConcierge()">
                </div>
                <button class="concierge-btn" onclick="runConcierge()"
                    style="width: 100%; margin-top: 10px; padding: 12px; background: linear-gradient(135deg, #003580, #0056b3); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: transform 0.2s;">
                    Inspirer moi
                </button>
                <div id="conciergeResults" class="concierge-suggestions" style="display: none; margin-top: 15px;"></div>
            </div>

            <div class="filter-card">
                <div class="filter-header">Filtrer par :</div>
                <div class="filter-body">
                    <div class="filter-group">
                        <h4>Ville</h4>
                        <label><input type="checkbox" value="Dakar" onchange="filterRestaurants()"> Dakar</label>
                        <label><input type="checkbox" value="Saly" onchange="filterRestaurants()"> Saly</label>
                        <label><input type="checkbox" value="Saint-Louis" onchange="filterRestaurants()">
                            Saint-Louis</label>
                        <label><input type="checkbox" value="Cap Skirring" onchange="filterRestaurants()"> Cap
                            Skirring</label>
                    </div>
                    <div class="filter-group">
                        <h4>Type de cuisine</h4>
                        <label><input type="checkbox" value="Africaine" onchange="filterRestaurants()">
                            Africaine</label>
                        <label><input type="checkbox" value="Fruits de Mer" onchange="filterRestaurants()"> Fruits de
                            Mer</label>
                        <label><input type="checkbox" value="Gastronomique" onchange="filterRestaurants()"> Chic</label>
                    </div>
                </div>
            </div>

            <div class="filter-group" style="margin-top: 1rem;">
                <button class="see-availability" onclick="openAdvancedFilters()"
                    style="width: 100%; height: auto; padding: 12px; background: white; color: #003580; border: 2px solid #003580; margin-bottom: 10px; font-weight:600; border-radius: 8px;">üîç
                    Filtres Avanc√©s</button>
                <button class="see-availability" onclick="resetFilters()"
                    style="width: 100%; height: auto; padding: 12px; background: #f5f5f5; color: #666; border: none; border-radius: 8px;">R√©initialiser</button>
            </div>
        </aside>

        <section class="results-area">
            <div id="mapContainer" class="map-view-container" style="display: none;">
                <div id="map"></div>
            </div>
            <div class="results-header">
                <h2 id="resultsCount">S√©lection des meilleurs √©tablissements</h2>
            </div>
            <div class="restaurant-list" id="restaurantGrid">
                <div id="featuredRestaurantsSection" style="width: 100%;">
                    <h3 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 1.5rem; color: #1a1a1a;">Nos
                        meilleures tables recommand√©es</h3>
                    <div id="dynamicListingGrid" style="display: flex; flex-direction: column; gap: 1rem;">
                        <!-- JS will populate this -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer" style="background: var(--booking-blue); color: white; margin-top: 4rem;">
        <div class="container" style="text-align: center; padding: 3rem 0;">
            <p>&copy; 2024 TerangaReserve.sn. Tous droits r√©serv√©s.</p>
            <div class="footer-links" style="margin-top: 1rem; display: flex; justify-content: center; gap: 20px;">
                <a href="#" style="color: white; text-decoration: none; font-size: 0.85rem; opacity: 0.8;"
                    onclick="toggleAdminPortal(); return false;">üîê Acc√®s Propri√©taire</a>
                <a href="#" style="color: white; text-decoration: none; font-size: 0.85rem; opacity: 0.8;"
                    onclick="toggleOwnerDashboard(); return false;">üë®‚Äçüç≥ Espace Restaurateur</a>
            </div>
        </div>
    </footer>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="booking-container">
            <span class="close-btn" onclick="closeModal()">&times;</span>

            <div id="bookingFlowWrapper">
                <h2 id="modalRestoName">R√©servation</h2>

                <div class="modal-tabs" id="modalTabs">
                    <button class="tab-btn active" onclick="switchModalTab('presentation')">Le Restaurant</button>
                    <button class="tab-btn" onclick="switchModalTab('menu')">La Carte</button>
                    <button class="tab-btn" onclick="switchModalTab('reviews')">Avis</button>
                    <button class="tab-btn" onclick="switchModalTab('booking')">R√©servation</button>
                    <button class="tab-btn" onclick="switchModalTab('tables')" style="display:none">Plan</button>
                </div>

                <!-- Step 0: Presentation -->
                <div id="tab-presentation" class="tab-content active">
                    <!-- Image Gallery Carousel -->
                    <div class="resto-gallery">
                        <button class="gallery-nav gallery-prev" onclick="scrollGallery(-1)"
                            style="display:none">‚Äπ</button>
                        <div class="gallery-container" id="restoGallery">
                            <!-- Images dynamically filled -->
                        </div>
                        <button class="gallery-nav gallery-next" onclick="scrollGallery(1)"
                            style="display:none">‚Ä∫</button>
                        <div class="gallery-dots" id="galleryDots"></div>
                    </div>

                    <div id="presentationContent">
                        <!-- Dynamically filled -->
                    </div>
                    <button class="reserve-btn" onclick="switchModalTab('menu')" style="margin-top: 20px;">Voir la
                        Carte</button>
                </div>

                <!-- Step 1: Booking Details -->
                <div id="tab-booking" class="tab-content">
                    <div class="table-preview-wrapper">
                        <img id="tablePreview" src="" class="table-preview" alt="Pr√©visualisation de la table">
                        <div class="preview-label">Pr√©visualisation de la table</div>
                    </div>
                    <form id="bookingForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label><span class="label-icon">üìÖ</span> Date de r√©servation</label>
                                <input type="date" id="bookingDate" class="enhanced-input" required>
                            </div>
                            <div class="form-group">
                                <label><span class="label-icon">üïê</span> Heure d'arriv√©e</label>
                                <input type="time" id="bookingTime" class="enhanced-input" required value="20:00">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label><span class="label-icon">üë•</span> Nombre de convives</label>
                                <input type="number" id="guestCount" class="enhanced-input" value="2" min="1" max="20">
                            </div>
                            <div class="form-group">
                                <label><span class="label-icon">üì±</span> T√©l√©phone (WhatsApp)</label>
                                <input type="tel" id="phoneInput" class="enhanced-input" placeholder="+221 77 123 45 67"
                                    required pattern="[+0-9 ]+">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label><span class="label-icon">üìß</span> Email (optionnel)</label>
                                <input type="email" id="emailInput" class="enhanced-input"
                                    placeholder="votre@email.com">
                            </div>
                        </div>
                        <div class="notification-options"
                            style="margin: 1rem 0; padding: 1rem; background: #f0f7ff; border-radius: 8px;">
                            <p style="font-weight: 600; margin-bottom: 0.75rem; color: #003580;">üîî Notifications de
                                confirmation :</p>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="smsNotification" checked
                                    style="width: auto; accent-color: #003580;">
                                <span>üì± Recevoir un SMS de confirmation</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" id="emailNotification"
                                    style="width: auto; accent-color: #003580;">
                                <span>üìß Recevoir un email r√©capitulatif</span>
                            </label>
                        </div>
                        <button type="submit" class="reserve-btn">Continuer vers l'Acompte ‚Üí</button>
                    </form>
                </div>

                <!-- Step 2: Table Selection -->
                <div id="tab-tables" class="tab-content">
                    <h3>Choisissez votre emplacement pr√©f√©r√©</h3>
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 1.5rem;">S√©lectionnez une table disponible
                        sur le plan interactif.</p>
                    <div class="floor-plan" id="floorPlan">
                        <!-- Tables rendered dynamically -->
                    </div>
                    <div class="plan-legend">
                        <span class="legend-item"><span class="legend-dot available"></span> Disponible</span>
                        <span class="legend-item"><span class="legend-dot selected"></span> Ma s√©lection</span>
                        <span class="legend-item"><span class="legend-dot occupied"></span> Occup√©</span>
                    </div>
                </div>

                <!-- Step 3: Payment (Hidden by default) -->
                <div id="tab-payment" class="tab-content">
                    <h3>Confirmer avec un acompte (20%)</h3>
                    <p id="paymentDepositText" style="font-size: 0.9rem; color: #666; margin: 10px 0;">Calcul de
                        l'acompte...</p>
                    <div class="payment-methods">
                        <div class="pay-btn orange" onclick="processRealPayment('orange')">
                            <!-- Logo Orange Money -->
                            <div class="payment-method-badge" style="display: flex; align-items: center; gap: 10px;">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Orange_logo.svg/1200px-Orange_logo.svg.png"
                                    class="pay-logo" alt="Orange Money" style="height: 30px;">
                                <span>Orange Money</span>
                            </div>
                        </div>
                        <div class="pay-btn wave" onclick="processRealPayment('wave')">
                            <!-- Logo Wave -->
                            <div class="payment-method-badge" style="display: flex; align-items: center; gap: 10px;">
                                <div
                                    style="background: #1dc4ff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white;">
                                    W</div>
                                <span>Wave</span>
                            </div>
                        </div>
                    </div>
                    <button class="tab-btn" style="width: 100%" onclick="switchModalTab('booking')">‚Üê Retour</button>
                </div>

                <!-- Menus & Reviews -->
                <div id="tab-menu" class="tab-content">
                    <div id="digitalMenuContent"></div>
                    <button class="reserve-btn" onclick="switchModalTab('booking')" style="margin-top: 20px;">R√©server
                        maintenant</button>
                </div>
            </div>
            <div id="tab-reviews" class="tab-content">
                <div id="reviewsContent"></div>
            </div>
        </div>

        <!-- Success -->
        <div id="successView" style="display: none;" class="success-msg">
            <div class="success-icon">‚úì</div>
            <h2>R√©servation Confirm√©e !</h2>
            <p id="successMainMessage">Acompte pay√© avec succ√®s.</p>
            <div id="notificationStatus"
                style="margin: 1.5rem 0; padding: 1rem; background: #e8f5e9; border-radius: 8px; text-align: left;">
                <p style="font-weight: 600; margin-bottom: 0.5rem; color: #2e7d32;">üîî Notifications envoy√©es :</p>
                <div id="smsStatus" style="display: none; padding: 0.5rem 0;">‚úÖ SMS de confirmation envoy√©</div>
                <div id="emailStatus" style="display: none; padding: 0.5rem 0;">‚úÖ Email r√©capitulatif envoy√©</div>
            </div>
            <div
                style="margin: 1.5rem 0; padding: 1.5rem; background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);">
                <p style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.75rem; color: #000;">üéÅ Programme
                    Teranga Rewards</p>
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                    <div style="font-size: 2rem;">+50</div>
                    <div style="text-align: left;">
                        <div style="font-weight: 600; color: #333;">Points gagn√©s !</div>
                        <div style="font-size: 0.85rem; color: #666;">Cumulables pour des r√©ductions</div>
                    </div>
                </div>
                <div
                    style="background: rgba(255,255,255,0.7); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
                    üí° <strong>100 points = 5.000 FCFA</strong> de r√©duction sur votre prochaine r√©servation
                </div>
            </div>
            <div id="bookingSummary"
                style="margin: 20px 0; background: #f9f9f9; padding: 15px; border-radius: 8px; text-align: left;">
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="see-availability" onclick="generatePDF()"
                    style="background: #e74c3c; flex: 1; min-width: 140px;">üìÑ Facture PDF</button>
                <button class="see-availability" id="btnBookTransportSuccess"
                    style="background: #27ae60; flex: 1; min-width: 140px;">üöï Yango/Wave</button>
                <button class="see-availability" onclick="openReferralModal()"
                    style="background: #febb02; color: #003580; flex: 1; min-width: 140px;">üéÅ Parrainer</button>
                <button class="see-availability" onclick="closeModal()"
                    style="background: #666; flex: 1; min-width: 140px;">Fermer</button>
            </div>
        </div>
    </div>
    </div>

    <!-- Owner Dashboard Overlay -->
    <div id="ownerDashboard">
        <div class="container dash-card" style="max-width: 1100px; margin-top: 2rem; position: relative;">
            <span class="close-btn" onclick="toggleOwnerDashboard()">&times;</span>
            <div class="dash-header">
                <h2>Portail Partenaire Teranga</h2>
            </div>

            <div class="modal-tabs">
                <button class="tab-btn active" id="btnDashReservations"
                    onclick="switchOwnerTab('reservations')">R√©servations</button>
                <button class="tab-btn" id="btnDashMenu" onclick="switchOwnerTab('menu')">Modifier ma Carte</button>
                <button class="tab-btn" id="btnDashStats" onclick="switchOwnerTab('stats')">Statistiques</button>
            </div>

            <!-- Tab: Reservations -->
            <div id="owner-tab-reservations" class="owner-tab-content">
                <div class="dash-stats"
                    style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem;">
                    <div class="dash-card" style="border: 1px solid #eee;">
                        <p style="color: #666; font-size: 0.8rem;">R√©servations</p>
                        <h3 id="statToday">0</h3>
                    </div>
                    <div class="dash-card" style="border: 1px solid #eee;">
                        <p style="color: #666; font-size: 0.8rem;">Revenus Acomptes</p>
                        <h3 id="statIncome">0 FCFA</h3>
                    </div>
                    <div class="dash-card" style="border: 1px solid #eee;">
                        <p style="color: #666; font-size: 0.8rem;">Visibilit√©</p>
                        <h3>Premium</h3>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date/Heure</th>
                            <th>Client</th>
                            <th>Couverts</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="bookingsTableBody"></tbody>
                </table>
            </div>

            <!-- Tab: Menu Management -->
            <div id="owner-tab-menu" class="owner-tab-content" style="display: none;">
                <div
                    style="background: #fff8e1; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem; font-size: 0.85rem; color: #856404;">
                    <strong>Mode √âdition :</strong> Les changements effectu√©s ici seront visibles imm√©diatement par les
                    clients.
                </div>
                <button class="see-availability" style="margin-bottom: 1.5rem;"
                    onclick="alert('Fonctionnalit√© d\'ajout en cours...')">+ Ajouter un Plat</button>
                <div id="ownerMenuContent"></div>
            </div>

            <!-- Tab: Stats -->
            <div id="owner-tab-stats" class="owner-tab-content" style="display: none;">
                <div style="height: 300px; margin-bottom: 2rem;">
                    <canvas id="reservationsChart"></canvas>
                </div>
                <div class="admin-card">
                    <p style="font-size: 0.9rem; color: #666;">Ces statistiques sont calcul√©es en temps r√©el sur la base
                        de vos r√©servations pass√©es et √† venir.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Master Dashboard / Backoffice (Owner of Platform) -->
    <div id="adminPortal">
        <aside class="admin-sidebar">
            <h2>Teranga Admin</h2>
            <nav class="admin-nav">
                <div class="admin-nav-item active" onclick="switchAdminTab('dashboard')">üè† Dashboard Central</div>
                <div class="admin-nav-item" onclick="switchAdminTab('restaurants')">üçΩÔ∏è Gestion Restaurants</div>
                <div class="admin-nav-item" onclick="switchAdminTab('users')">üë• Gestion Utilisateurs</div>
                <div class="admin-nav-item" onclick="switchAdminTab('visitors')">üëÅÔ∏è Visiteurs & Inscriptions</div>
                <div class="admin-nav-item" onclick="switchAdminTab('settings')">‚öôÔ∏è Config & Commissions</div>
                <div class="admin-nav-item" onclick="switchAdminTab('analytics')">üìä Analytics Globaux</div>
                <div class="admin-nav-item" onclick="switchAdminTab('backups')">üíæ Backups & Donn√©es</div>
                <div class="admin-nav-item" style="margin-top: auto; color: #ff4757;" onclick="closeAdminPortal()">üö™
                    Quitter</div>
            </nav>
        </aside>

        <main class="admin-main">
            <header class="admin-header">
                <h1 id="adminTitle">Dashboard Central</h1>
                <div class="backup-indicator">
                    <div class="pulse"></div>
                    <span>Syst√®me en ligne ‚Ä¢ Synchro Cloud OK</span>
                </div>
            </header>

            <!-- Tab: Global Dashboard -->
            <div id="admin-tab-dashboard" class="admin-content">
                <div class="admin-stats-grid">
                    <div class="stat-card">
                        <h4>Revenus Tots</h4>
                        <p id="totalRevenueAdmin">0 FCFA</p>
                    </div>
                    <div class="stat-card">
                        <h4>Restaurants</h4>
                        <p id="totalPartnersAdmin">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Utilisateurs</h4>
                        <p id="totalUsersAdmin">12</p>
                    </div>
                    <div class="stat-card">
                        <h4>Visiteurs (24h)</h4>
                        <p>142</p>
                    </div>
                </div>

                <div class="admin-card">
                    <h3>Derni√®res Activit√©s</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Restaurant</th>
                                <th>Action</th>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="adminActivityLog"></tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Manage Restaurants -->
            <div id="admin-tab-restaurants" class="admin-content" style="display: none;">
                <div class="admin-card">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <h3>Restaurants Partenaires</h3>
                        <button class="action-btn" onclick="toggleAddRestoModal()">+ Nouveau Restaurant</button>
                    </div>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Ville</th>
                                <th>Cuisine</th>
                                <th>Perf</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminRestoList"></tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Manage Users -->
            <div id="admin-tab-users" class="admin-content" style="display: none;">
                <div class="admin-card">
                    <h3>Gestion des Comptes Utilisateurs</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>R√¥le</th>
                                <th>Email</th>
                                <th>Derni√®re Connexion</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Moussa Diop</strong></td>
                                <td>Administrateur</td>
                                <td>moussa@teranga.sn</td>
                                <td>Il y a 10 min</td>
                                <td><button class="action-btn">Editer</button></td>
                            </tr>
                            <tr>
                                <td><strong>Samba Sow</strong></td>
                                <td>Propri√©taire (Lagon)</td>
                                <td>samba@lagon1.com</td>
                                <td>Hier</td>
                                <td><button class="action-btn">Editer</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Visitors & Signups -->
            <div id="admin-tab-visitors" class="admin-content" style="display: none;">
                <div class="admin-card">
                    <div class="admin-stats-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="stat-card">
                            <h4>Inscriptions Newsletter</h4>
                            <p>256</p>
                        </div>
                        <div class="stat-card">
                            <h4>Demandes Partenariat</h4>
                            <p>8</p>
                        </div>
                    </div>
                    <h3 style="margin-top: 2rem;">Derniers Visiteurs Inscrits</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Date Inscription</th>
                                <th>Provenance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>aminata.k@gmail.com</td>
                                <td>11/02/2026</td>
                                <td>Dakar Search</td>
                            </tr>
                            <tr>
                                <td>j.dupont@voyage.fr</td>
                                <td>10/02/2026</td>
                                <td>Instagram</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Settings & Commissions -->
            <div id="admin-tab-settings" class="admin-content" style="display: none;">
                <div class="admin-card">
                    <h3>Configuration des Commissions</h3>
                    <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 2rem;">D√©finissez le pourcentage pr√©lev√©
                        par la plateforme sur chaque acompte pay√©.</p>
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div class="form-group" style="flex: 1;">
                            <label style="color: #94a3b8; display: block; margin-bottom: 8px;">Taux de Commission
                                (%)</label>
                            <input type="number" id="commissionRate" value="15"
                                style="background:#0f172a; border:1px solid #334155; color:white; padding:10px; width:100px; border-radius:4px;">
                        </div>
                        <button class="action-btn" style="background:var(--primary); color:#333; margin-top:25px;"
                            onclick="updateCommission()">Enregistrer le Taux</button>
                    </div>
                </div>
                <div class="admin-stats-grid">
                    <div class="stat-card">
                        <h4>Revenus Plateforme (Total)</h4>
                        <p id="platformCommissionTotal">0 FCFA</p>
                    </div>
                    <div class="stat-card">
                        <h4>Moyenne par R√©sa</h4>
                        <p id="avgCommissionPerRes">0 FCFA</p>
                    </div>
                </div>
            </div>

            <!-- Tab: Data & Backups -->
            <div id="admin-tab-backups" class="admin-content" style="display: none;">
                <div class="admin-card">
                    <h3>Centre de Sauvegarde (JSON/CSV Export)</h3>
                    <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 2rem;">T√©l√©chargez l'int√©gralit√© de vos
                        donn√©es restaurants, utilisateurs et transactions pour une s√©curit√© maximale.</p>
                    <div style="display: flex; gap: 1rem;">
                        <button class="see-availability" onclick="exportData('json')"
                            style="background:var(--primary); color:#333;">T√©l√©charger Backup JSON</button>
                        <button class="see-availability" onclick="exportData('csv')"
                            style="background:#334155;">Exporter Transactions CSV</button>
                    </div>
                </div>
            </div>

            <!-- Modal: Ajouter Restaurant -->
            <div id="admin-modal-resto" class="admin-card"
                style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:5000; width:500px; max-height: 90vh; overflow-y: auto; background: #1e293b; box-shadow: 0 0 50px rgba(0,0,0,0.5);">
                <div style="display:flex; justify-content:space-between; margin-bottom: 1.5rem;">
                    <h3>Inscrire un Nouveau Restaurant</h3>
                    <span style="cursor:pointer; font-size: 1.5rem;" onclick="toggleAddRestoModal()">&times;</span>
                </div>
                <form id="addRestoForm">
                    <div class="form-group"><label style="display:block; margin-bottom:5px; color:#94a3b8;">Nom du
                            Restaurant</label><input type="text" id="newRestoName" required
                            style="width:100%; padding:10px; margin-bottom:15px; background:#0f172a; border:1px solid #334155; color:white; border-radius:4px;">
                    </div>
                    <div class="form-group"><label
                            style="display:block; margin-bottom:5px; color:#94a3b8;">Ville</label><select
                            id="newRestoCity"
                            style="width:100%; padding:10px; margin-bottom:15px; background:#0f172a; border:1px solid #334155; color:white; border-radius:4px;">
                            <option>Dakar</option>
                            <option>Saly</option>
                            <option>Saint-Louis</option>
                        </select></div>
                    <div class="form-group"><label
                            style="display:block; margin-bottom:5px; color:#94a3b8;">Cuisine</label><input type="text"
                            id="newRestoCuisine" required
                            style="width:100%; padding:10px; margin-bottom:15px; background:#0f172a; border:1px solid #334155; color:white; border-radius:4px;">
                    </div>
                    <div class="form-group"><label style="display:block; margin-bottom:5px; color:#94a3b8;">Prix Moyen
                            (FCFA)</label><input type="number" id="newRestoAvgPrice" required
                            style="width:100%; padding:10px; margin-bottom:15px; background:#0f172a; border:1px solid #334155; color:white; border-radius:4px;">
                    </div>
                    <button type="submit" class="reserve-btn"
                        style="width:100%; margin-top:10px; padding:12px;">Enregistrer le Restaurant</button>
                </form>
            </div>
        </main>
    </div>

    </div>

    <!-- Passport Modal -->


    <!-- Chat Widget -->
    <div id="chatWidget" class="chat-widget">
        <button class="chat-bubble" onclick="toggleChatWidget()">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <path
                    d="M16 2C8.268 2 2 8.268 2 16C2 18.568 2.688 21.016 3.92 23.12L2.28 29.72L9.08 28.12C11.104 29.256 13.44 29.92 16 29.92C23.732 29.92 30 23.652 30 15.92C30 12.172 28.528 8.636 25.968 6.076C23.408 3.516 19.872 2.044 16.044 2.044L16 2ZM16 4C19.444 4 22.668 5.344 25.028 7.704C27.388 10.064 28.732 13.288 28.732 16.732C28.732 22.648 23.916 27.464 16 27.464C13.76 27.464 11.588 26.848 9.712 25.688L9.28 25.44L5.52 26.4L6.52 22.76L6.24 22.28C4.984 20.336 4.32 18.096 4.32 15.776C4.32 9.86 9.136 5.044 15.052 5.044L16 4ZM10.8 9.2C10.56 9.2 10.16 9.28 9.84 9.64C9.52 10 8.64 10.84 8.64 12.56C8.64 14.28 9.88 15.92 10.08 16.2C10.28 16.48 12.8 20.48 16.88 22C20.32 23.28 20.96 23.04 21.64 22.96C22.32 22.88 23.76 22.08 24.08 21.24C24.4 20.4 24.4 19.68 24.32 19.52C24.24 19.36 23.96 19.28 23.56 19.08C23.16 18.88 21.44 18.04 21.08 17.92C20.72 17.8 20.48 17.76 20.2 18.16C19.92 18.56 19.28 19.36 19.04 19.64C18.8 19.92 18.56 19.96 18.16 19.76C17.76 19.56 16.48 19.12 14.96 17.76C13.76 16.68 12.96 15.36 12.72 14.96C12.48 14.56 12.68 14.36 12.88 14.16C13.08 13.96 13.28 13.64 13.48 13.4C13.68 13.16 13.76 13 13.88 12.76C14 12.52 13.92 12.28 13.84 12.08C13.76 11.88 12.96 10.16 12.64 9.36C12.32 8.6 12 8.68 11.76 8.68C11.52 8.68 11.24 8.68 10.96 8.68L10.8 9.2Z"
                    fill="white" />
            </svg>
            <span class="chat-badge" id="chatBadge" style="display: none;">1</span>
        </button>
        <div class="chat-window" id="chatWindow" style="display: none;">
            <div class="chat-header">
                <div>
                    <h4>üí¨ Chat Support</h4>
                    <p>Besoin d'aide ? Nous sommes l√† !</p>
                </div>
                <button onclick="toggleChatWidget()"
                    style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">√ó</button>
            </div>
            <div class="chat-body">
                <div class="chat-message bot">
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        <p>Bonjour ! Comment puis-je vous aider aujourd'hui ?</p>
                        <span class="message-time">Maintenant</span>
                    </div>
                </div>
                <div class="chat-options">
                    <button class="chat-option-btn" onclick="selectChatOption('info')">
                        ‚ÑπÔ∏è Informations sur un restaurant
                    </button>
                    <button class="chat-option-btn" onclick="selectChatOption('reservation')">
                        üìÖ Aide √† la r√©servation
                    </button>
                    <button class="chat-option-btn" onclick="selectChatOption('modification')">
                        ‚úèÔ∏è Modifier une r√©servation
                    </button>
                    <button class="chat-option-btn" onclick="selectChatOption('whatsapp')">
                        üí¨ Parler avec un conseiller (WhatsApp)
                    </button>
                </div>
            </div>
            <div class="chat-footer">
                <input type="text" id="chatInput" placeholder="Tapez votre message..." />
                <button onclick="sendChatMessage()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 10L18 2L14 18L10 12L2 10Z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts critiques - charg√©s imm√©diatement -->
    <script type="module" src="/app.js"></script>

    <!-- Scripts non-critiques - charg√©s avec defer -->
    <script type="module" src="/pwa.js"></script>
    <script type="module" src="/backend-sync.js"></script>
    <script type="module" src="/transport.js"></script>
    <script type="module" src="/gamification.js"></script>
    <script type="module" src="/advanced-search.js"></script>
    <script type="module" src="/payment-wave.js"></script>
    <script type="module" src="/referral.js"></script>
    <script type="module" src="/gallery-logic.js"></script>
    <!-- IA Intelligente -->
    <script type="module" src="/chat.js"></script>
    <script type="module" src="/concierge-ai.js"></script>

    <!-- Injection du Chat Widget (HTML Structure Only) -->
    <script>
        fetch('/chat-widget.html')
            .then(response => response.text())
            .then(html => {
                const div = document.createElement('div');
                div.innerHTML = html;
                if (div.firstElementChild) {
                    // Remove existing scripts in the fetched HTML to avoid conflicts
                    const scripts = div.querySelectorAll('script');
                    scripts.forEach(s => s.remove());
                    document.body.appendChild(div.firstElementChild);

                    // Init Chatbot after DOM injection
                    if (window.initChatbot) window.initChatbot();
                }
            });
    </script>
    <!-- Bottom Navigation (Mobile Only) -->
    <nav class="mobile-bottom-nav">
        <button class="nav-item active" onclick="location.href='/'">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Explorer</span>
        </button>
        <button class="nav-item" onclick="location.href='/carte.html'">
            <span class="nav-icon">üó∫Ô∏è</span>
            <span class="nav-label">Carte</span>
        </button>
        <button class="nav-item concierge-item" onclick="toggleChat()">
            <div class="concierge-circle">ü§ñ</div>
            <span class="nav-label">Concierge</span>
        </button>
        <button class="nav-item" onclick="openPassport()">
            <span class="nav-icon">üõÇ</span>
            <span class="nav-label">Passeport</span>
        </button>
        <button class="nav-item" onclick="openUserDashboard()">
            <span class="nav-icon">üë§</span>
            <span class="nav-label">Profil</span>
        </button>
    </nav>

    <script>
        // Mobile Menu Toggle
        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            const btn = document.querySelector('.mobile-menu-toggle');

            navLinks.classList.toggle('active');
            btn.innerHTML = navLinks.classList.contains('active') ? '‚úï' : '‚ò∞';
        }

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            const navLinks = document.getElementById('navLinks');
            const btn = document.querySelector('.mobile-menu-toggle');

            if (navLinks.classList.contains('active') &&
                !navLinks.contains(e.target) &&
                !btn.contains(e.target)) {
                navLinks.classList.remove('active');
                btn.innerHTML = '‚ò∞';
            }
        });

        // Close menu when clicking a link
        document.querySelectorAll('.nav-links button, .nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                const navLinks = document.getElementById('navLinks');
                const btn = document.querySelector('.mobile-menu-toggle');
                navLinks.classList.remove('active');
                btn.innerHTML = '‚ò∞';
            });
        });
    </script>
</body>

</html>